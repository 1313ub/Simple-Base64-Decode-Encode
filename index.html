<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Base64 Decode & Encode</title>
<link rel="icon" href="icon.png" type="image/png">
<style>
    body { font-family: sans-serif; margin:0; padding:0; }
    .container { display: flex; flex-direction: column; align-items: center; gap: 30px; margin-top: 50px; }
    .panel { width: 50%; padding: 20px; border:1px solid #ccc; border-radius:12px; box-shadow:2px 2px 6px rgba(0,0,0,0.1); text-align:center; background-color: rgba(255,255,255,0.6); }
    textarea { width: 100%; height: 200px; font-family: monospace; font-size:14px; resize: none; overflow-y:auto; }
    .result { margin-top: 10px; font-size:16px; word-wrap: break-word; white-space: pre-wrap; }
    .hint { margin-top: 10px; font-size:12px; color: gray; }
    a, span { color: blue; text-decoration: underline; cursor:pointer; }
    .toast { position: fixed;bottom: 60px; left: 50%; transform: translateX(-50%); background: rgba(0, 0, 0, 0.75);color: #fff;padding: 10px 20px;border-radius: 8px;font-size: 16px;opacity: 0;transition: opacity 0.5s ease-in-out;z-index: 1000; }
    @media (max-width: 760px) {
        .panel { width: 90%; }
    }
    body.mobile .panel { width:90%; }
    body.mobile button { font-size:46px; margin-bottom: 10px; }
    body.mobile textarea { height: 320px; font-size:46px; }
    body.mobile h2 { font-size: 72px; }
    body.mobile h3 { font-size: 64px; }
    body.mobile .result { font-size: 64px; }
    body.mobile .hint { font-size: 30px; }
    body.mobile .toast { font-size: 42px; padding: 20px 40px; bottom: 100px; }
    #toggleModeBtn { position: fixed; bottom:10px; right:10px; z-index:999; padding:8px 12px; border-radius:8px; border:none; background-color:#007bff; color:white; cursor:pointer; }
</style>
</head>
<body>
<div class="container">
    <div class="panel">
        <h3>Decode</h3>
        <button id="pasteDecodeBtn">붙여넣기</button>
        <textarea id="decodeInput" placeholder="여기에 Base64 문자열 입력" autocomplete="off"></textarea>
        <div id="decodeResult" class="result"></div>
        <div class="hint">클릭으로 복사 | 사이트로 이동</div>
    </div>

    <div class="panel">
        <h3>Encode</h3>
        <button id="pasteEncodeBtn">붙여넣기</button>
        <textarea id="encodeInput" placeholder="여기에 문자열 입력" autocomplete="off"></textarea>
        <div id="encodeResult" class="result"></div>
        <div class="hint">클릭으로 복사 | 사이트로 이동</div>
    </div>
</div>

<h2 style="text-align:center;">Base64 Decode & Encode</h2>
<button id="toggleModeBtn">모바일/PC 전환</button>
<div id="toast" class="toast"></div>

<script>
function setUIMode(mode) {
    if(mode==="mobile") {
        document.body.classList.add("mobile");
        document.body.classList.remove("pc");
    } else {
        document.body.classList.add("pc");
        document.body.classList.remove("mobile");
    }
}

// 안전하게 여러 줄 디코드 + 줄바꿈 유지 + 링크/텍스트 구분
function updateDecode() {
    var inputText = document.getElementById("decodeInput").value.trim();
    var lines = inputText.split(/\r?\n/);
    var decodedLines = [];

    lines.forEach(function(line) {
        line = line.trim();
        if(line.length === 0) return;

        var decoded = tryDecodeSafe(line);
        if(decoded === null) decoded = tryDecodeSafe(line.replace(/\r?\n/g, ''));
        if(decoded === null) decoded = "[오류] " + line;

        decodedLines.push(decoded);
    });

    showCopyableResult("decodeResult", decodedLines.join("\n"));
}

function tryDecodeSafe(str) {
    try {
        return decodeURIComponent(escape(atob(str)));
    } catch(e) {
        return null;
    }
}

function showCopyableResult(elementId, text) {
    var result = document.getElementById(elementId);
    result.innerHTML = "";

    var lines = text.split(/\r?\n/);
    lines.forEach(function(line, index) {
        line = line.trim();
        if(line.length === 0) return;

        if(line.startsWith("http://") || line.startsWith("https://")) {
            var a = document.createElement("a");
            a.href = line;
            a.target = "_blank";
            a.textContent = line;
            a.style.color = "blue";
            a.style.display = "block";        // 블록으로 만들기
            a.style.marginBottom = "16px";     // 줄 간격 추가
            result.appendChild(a);
        } else {
            var span = document.createElement("span");
            span.textContent = line;
            span.style.color = "black";
            span.style.display = "block";     // 블록으로 만들기
            span.style.marginBottom = "16px";  // 줄 간격 추가
            span.onclick = function() {
                navigator.clipboard.writeText(line).then(()=>{
                    showToast("복사되었습니다");
                });
            };
            result.appendChild(span);
        }
    });
}

function updateEncode(){
    var inputText=document.getElementById("encodeInput").value.trim();
    try {
        var encoded=btoa(unescape(encodeURIComponent(inputText)));
        showCopyableResult("encodeResult", encoded);
    } catch(e){
        document.getElementById("encodeResult").textContent="오류";
    }
}

let toastTimeout;
function showToast(message) {
    if(document.body.classList.contains("mobile")) return;

    const toast = document.getElementById("toast");
    toast.textContent = message;
    toast.style.opacity = "1";
    toast.style.visibility = "visible";

    if(toastTimeout) clearTimeout(toastTimeout);

    toastTimeout = setTimeout(() => {
        toast.style.opacity = "0";
        toastTimeout = setTimeout(() => {
            toast.style.visibility = "hidden";
            toastTimeout = null;
        }, 500);
    }, 1500);
}

window.addEventListener("load", function(){
    const mode=localStorage.getItem("uiMode")||"pc";
    setUIMode(mode);

    ["encodeInput","decodeInput"].forEach(function(id){
        var input=document.getElementById(id);
        input.addEventListener("focus", function(){ input.value=""; });
        input.addEventListener("input", id==="encodeInput"?updateEncode:updateDecode);
    });

    document.getElementById("pasteEncodeBtn").addEventListener("click", async function(){
        try {
            const text=await navigator.clipboard.readText();
            document.getElementById("encodeInput").value=text;
            updateEncode();
            if(!document.body.classList.contains("mobile")) showToast("붙여넣었습니다");
        } catch(e){ console.error(e); }
    });
    document.getElementById("pasteDecodeBtn").addEventListener("click", async function(){
        try {
            const text=await navigator.clipboard.readText();
            document.getElementById("decodeInput").value=text;
            updateDecode();
            if(!document.body.classList.contains("mobile")) showToast("붙여넣었습니다");
        } catch(e){ console.error(e); }
    });

    document.getElementById("toggleModeBtn").addEventListener("click", function(){
        const current=document.body.classList.contains("mobile")?"mobile":"pc";
        const next=current==="mobile"?"pc":"mobile";
        setUIMode(next);
        localStorage.setItem("uiMode", next);
    });
});
</script>
</body>
</html>